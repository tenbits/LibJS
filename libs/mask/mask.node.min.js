(function(e,t){"use strict";null==e&&"undefined"!=typeof global&&(e=global);var n="undefined"==typeof document?null:document,r=function(r){null==r&&(r={});var o,l=t(e,n,r);for(o in r)l[o]=r[o];return l};if("undefined"!=typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define(r);else{var o={},l=r(o);e.mask=l;for(var i in o)e[i]=o[i]}})(this,function(global,document,exports){"use strict";function util_extend(e,t){null==e&&(e={});for(var n in t)hasOwnProp.call(t,n)!==!1&&(e[n]=t[n]);return e}function util_getProperty(e,t){if("."===t)return e;for(var n=e,r=t.split("."),o=-1,l=r.length;null!=n&&l>++o;)n=n[r[o]];return n}function util_interpolate(e,t,n,r,o,l,i){for(var s,a,u,c,f=e.length,d=0,p=null,h="",g=!0;f>d;d++)g===!0?null==p?h+=e[d]:p.push(e[d]):(c=e[d],a=null,u=c.indexOf(":"),-1===u?a=util_getProperty(n,c):(s=u>0?c.substring(0,u).replace(regexpWhitespace,""):"",""===s&&(s="expression"),c=c.substring(u+1),"function"==typeof ModelUtils[s]&&(a=ModelUtils[s](c,n,r,o,l,i,t))),null!=a&&("object"==typeof a&&null==p&&(p=[h]),null==p?h+=a:p.push(a))),g=!g;return null==p?h:p}function Template(e){this.template=e,this.index=0,this.length=e.length}function Node(e,t){this.type=Dom.NODE,this.tagName=e,this.parent=t,this.attr={}}function TextNode(e,t){this.content=e,this.parent=t,this.type=Dom.TEXTNODE}function Fragment(){this.nodes=[]}function Component(e,t,n){this.tagName=e,this.parent=t,this.controller=n,this.attr={}}var regexpWhitespace=/\s/g,regexpEscapedChar={"'":/\\'/g,'"':/\\"/g,"{":/\\\{/g,">":/\\>/g,";":/\\>/g},hasOwnProp={}.hasOwnProperty,listeners=null;Template.prototype={skipWhitespace:function(){for(var e=this.template,t=this.index,n=this.length;n>t&&!(e.charCodeAt(t)>32);t++);return this.index=t,this},skipToAttributeBreak:function(){var e,t=this.template,n=this.index,r=this.length;do if(e=t.charCodeAt(++n),35===e&&123===t.charCodeAt(n+1))return this.index=n,this.sliceToChar("}"),this.index++,void 0;while(46!==e&&35!==e&&62!==e&&123!==e&&32!==e&&59!==e&&r>n);this.index=n},sliceToChar:function(e){for(var t,n,r=this.template,o=this.index,l=o,i=!1;(n=r.indexOf(e,o))>-1&&(o=n,92===r.charCodeAt(o-1));)i=!0,o++;return t=r.substring(l,o),this.index=o,i?t.replace(regexpEscapedChar[e],e):t}};var ConditionUtil=function(){function e(e,t){var n,r=t,o=e.index;if(null==r&&(e.skipWhitespace(),o=e.index,t=r=e.template.charCodeAt(e.index)),34===r||39===r)return e.index++,n=e.sliceToChar(39===r?"'":'"'),e.index++,n;do r=e.template.charCodeAt(++e.index);while(e.index<e.length&&32!==r&&33!==r&&60!==r&&61!==r&&62!==r&&40!==r&&41!==r&&38!==r&&124!==r);return n=e.template.substring(o,e.index),r=t,45===r||r>47&&58>r?n-0:116===r&&"true"===n?!0:102===r&&"false"===n?!1:{value:n}}function t(n,r){var o,l={assertions:null,join:null,left:null,right:null};null==r&&(r=[]),"string"==typeof n&&(n=new Template(n));e:for(;;){if(n.skipWhitespace(),n.index>=n.length)break;switch(o=n.template.charCodeAt(n.index)){case 61:case 60:case 62:case 33:var i=n.index;do o=n.template.charCodeAt(++n.index);while(n.index<n.length&&(60===o||61===o||62===o));l.sign=n.template.substring(i,n.index);continue;case 38:case 124:n.template.charCodeAt(++n.index)!==o&&console.error("Unary operation not valid"),l.join=38===o?"&&":"||",r.push(l),l={assertions:null,join:null,left:null,right:null},++n.index;continue;case 40:n.index++,t(n,l.assertions=[]);break;case 41:n.index++;break e;default:l[null==l.left?"left":"right"]=e(n,o);continue}}return(l.left||l.assertions)&&r.push(l),r}function n(n){if(null!=o[n])return o[n];var r=n.length,l={assertions:null,case1:null,case2:null},i=n.indexOf("?"),s=new Template(n);return-1!==i&&(s.length=i),l.assertions=t(s),-1!==i&&(s.length=r,s.index=i+1,l.case1=e(s),s.skipWhitespace(),58===s.template.charCodeAt(s.index)&&(s.index++,l.case2=e(s))),o[n]=l}function r(e,t){"string"==typeof e&&(e=n(e).assertions),null!=e.assertions&&(e=e.assertions);var o,l,i,s,a,u=!1;for(s=0,a=e.length;a>s;s++){if(o=e[s],o.assertions)u=r(o.assertions,t);else if(l="object"==typeof o.left?util_getProperty(t,o.left.value):o.left,null==o.right)u=l,"!"===o.sign&&(u=!u);else switch(i="object"==typeof o.right?util_getProperty(t,o.right.value):o.right,o.sign){case"<":u=i>l;break;case"<=":u=i>=l;break;case">":u=l>i;break;case">=":u=l>=i;break;case"!=":u=l!==i;break;case"==":u=l===i}if(u){if("&&"===o.join)continue;break}if("||"!==o.join&&"&&"===o.join)for(++s;a>s&&"||"!==e[s].join;s++);}return u}var o=[];return{condition:function(e,t){var o=n(e),l=r(o.assertions,t);return null!=o.case1&&(l=l?o.case1:o.case2),null==l?"":"object"==typeof l&&l.value?util_getProperty(t,l.value):l},isCondition:r,parse:n,out:{isCondition:r,parse:n}}}(),ExpressionUtil=function(){function e(e){this.parent=e,this.type=G,this.body=[],this.join=null}function t(e){this.parent=e}function n(e){this.type=J,this.body=e,this.join=null}function r(e,t){this.parent=e,this.type=Q,this.body=t,this.arguments=[],this.next=null}function o(e,t){this.parent=e,this.type=Y,this.body=t,this.next=null}function l(e,t){this.parent=e,this.prefix=t}function i(t){this.body=t,this.case1=new e(this),this.case2=new e(this)}function s(e,t){null==e&&console.error("Undefined",e,t);var n=e.type;return G===n?(e.body.push(t),t):K===n||V===n?e.body=t:Y===n||Q===n?e.next=t:(console.error("Unsupported - append:",e,t),t)}function a(){if(0===arguments.length)return null;var t=new e(arguments[0].parent);return t.join=arguments[arguments.length-1].join,t.body=Array.prototype.slice.call(arguments),t}function u(e){if(e.type!==G)return null!=e.body&&"object"==typeof e.body&&u(e.body),void 0;for(var t,n,r,o=e.body,l=0,i=o.length;i>l;l++)u(o[l]);for(l=1;i>l&&(t=o[l],n=o[l-1],!(nt[n.join]>nt[t.join]));l++);if(l!==i){for(r=[o[0]],l=1;i>l;l++)t=o[l],n=o[l-1],nt[n.join]>nt[t.join]&&i-1>l&&(t=a(o[l],o[++l])),r.push(t);e.body=r}}function c(e,t){console.error("Expression parser:",e,t,y.substring(x))}function f(e,t,n,r){var o,l,i=e,s=e.body;if(null==l&&null!=t&&(o=t,l=t[s]),null==l&&null!=n&&(o=n,l=n[s]),null==l&&null!=r)do o=r,l=r[s];while(null==l&&null!=(r=r.parent));if(null!=l)for(;;){if(i.type===Q){for(var a,u=[],f=0,d=i.arguments.length;d>f;f++)a=i.arguments[f],u[f]=v(a,t,n,r);l=l.apply(o,u)}if(null==l||null==i.next)break;if(i=i.next,s=i.body,o=l,l=l[s],null==l)break}return null==l&&(null==i||null!=i.next)&&c("Mask - Accessor error - ",s),l}function d(e){for(var t,n,r=!1,o=39===e?"'":'"',l=x;(t=y.indexOf(o,x))>-1&&(x=t,92===y.charCodeAt(t-1));)r=!0,x++;return n=y.substring(l,x),r===!0&&(n=n.replace(regexpEscapedChar[o],o)),n}function p(){for(var e,t,n=x;;){if(e=y.charCodeAt(x),46===e){if(t===!0)return c("Unexpected punc"),null;t=!0}if(!((e>=48&&57>=e||46===e)&&C>x))break;x++}return+y.substring(n,x)}function h(){var e,t=x,n=y.charCodeAt(x);if(34===n||39===n)return x++,e=d(n),x++,e;for(;;){n=y.charCodeAt(x);{if(!(n>47&&58!==n&&60!==n&&61!==n&&62!==n&&63!==n&&124!==n&&C>x))break;x++}}return y.substring(t,x)}function g(e){if(null==e&&x===C)return null;switch(e){case 40:return H;case 41:return U;case 44:return $;case 46:return F;case 43:return k;case 45:return w;case 42:return A;case 47:return O;case 37:return T;case 61:return y.charCodeAt(++x)!==e?(c("Not supported (Apply directive) - view can only access model/controllers"),null):R;case 33:return 61===y.charCodeAt(x+1)?(x++,D):j;case 62:return 61===y.charCodeAt(x+1)?(x++,S):I;case 60:return 61===y.charCodeAt(x+1)?(x++,P):L;case 38:return y.charCodeAt(++x)!==e?(c("Single Binary Operator AND"),null):_;case 124:return y.charCodeAt(++x)!==e?(c("Single Binary Operator OR"),null):E;case 63:return q;case 58:return X}return e>=65&&90>=e||e>=97&&122>=e||95===e||36===e?B:e>=48&&57>=e?W:34===e||39===e?z:(c("Unexpected / Unsupported directive"),null)}function m(a){y=a,x=0,C=a.length,b=new e;var f,m,v=b,N=et;e:for(;;)if(C>x&&33>(f=y.charCodeAt(x)))x++;else{if(x>=C)break;if(m=g(f),null==m&&C>x)break;switch(m){case H:v=s(v,new t(v)),v=s(v,new e(v)),x++;continue;case U:var M=G;N===tt&&(N=et,M=Q);do v=v.parent;while(null!=v&&v.type!==M);if(M===G&&(v=v.parent),null==v){c("OutOfAst Exception - body closed");break e}x++;continue;case $:if(N!==tt){c("Unexpected punctuation, comma");break e}do v=v.parent;while(null!=v&&v.type!==Q);if(null==v){c("OutOfAst Exception - next argument");break e}v=v.newArgument(),x++;continue;case q:b=new i(b),v=b.case1,x++;continue;case X:v=b.case2,x++;continue;case F:f=y.charCodeAt(x+1),f>=48&&57>=f?m=W:(m=B,x++)}if(v.type===G&&(v=s(v,new t(v))),w!==m&&j!==m||null!=v.body)switch(m){case w:case k:case A:case O:case T:case _:case E:case R:case D:case I:case S:case L:case P:for(;v&&v.type!==K;)v=v.parent;if(null==v.body){c("Unexpected operator",v);break e}v.join=m;do v=v.parent;while(null!=v&&v.type!==G);null==v&&console.error("Unexpected parent",v),x++;continue;case z:case W:if(null!=v.body&&null==v.join){c("Directive Expected");break}z===m&&(x++,s(v,new n(d(f))),x++),W===m&&s(v,new n(p(f)));continue;case B:for(var Y=h();C>x;){f=y.charCodeAt(x);{if(!(33>f))break;x++}}if(40===f){N=tt,x++;var J=s(v,new r(v,Y));v=J.newArgument();continue}110===f&&"null"===Y&&(Y=null),102===f&&"false"===Y&&(Y=!1),116===f&&"true"===Y&&(Y=!0),v=s(v,"string"==typeof Y?new o(v,Y):new n(Y))}else v=s(v,new l(v,m)),x++}return null==v.body&&v.type===K&&c("Unexpected end of expression"),u(b),b}function v(e,t,n,r){var o,l;if(null==e)return null;l="string"==typeof e?N.hasOwnProperty(e)===!0?N[e]:N[e]=m(e):e;var i,s,a,u=l.type;if(G===u){var c,d;e:for(i=0,a=l.body.length;a>i;i++)if(s=l.body[i],c=v(s,t,n,r),null!=d){if(d.join===_)if(o)o=c;else for(;a>i&&l.body[i].join!==E;i++);if(d.join===E){if(o)break e;if(c){o=c;break e}}switch(d.join){case w:o-=c;break;case k:o+=c;break;case O:o/=c;break;case A:o*=c;break;case T:o%=c;break;case D:o=o!=c;break;case R:o=o==c;break;case I:o=o>c;break;case S:o=o>=c;break;case L:o=c>o;break;case P:o=c>=o}d=s}else d=s,o=c}if(K===u)return v(l.body,t,n,r);if(J===u)return l.body;if(Y===u||Q===u)return f(l,t,n,r);if(V===u)switch(o=v(l.body,t,n,r),l.prefix){case w:o=-o;break;case j:o=!o}return Z===u&&(o=v(l.body,t,n,r),o=v(o?l.case1:l.case2,t,n,r)),o}var y,b,x=0,C=0,N={},w="-",k="+",O="/",A="*",T="%",E="||",_="&&",j="!",R="==",D="!=",I=">",S=">=",L="<",P="<=",M=".",H=20,U=21,$=22,F=23,q=24,X=25,B=30,z=31,W=32,G=1,K=2,Y=3,Q=4,J=6,V=9,Z=10,et=1,tt=2,nt={};nt[M]=1,nt[O]=2,nt[A]=2,nt[w]=3,nt[k]=3,nt[I]=4,nt[S]=4,nt[L]=4,nt[P]=4,nt[R]=5,nt[D]=5,nt[_]=6,nt[E]=6,t.prototype={constructor:t,type:K,join:null,body:null},r.prototype={constructor:r,newArgument:function(){var t=new e(this);return this.arguments.push(t),t}},l.prototype={constructor:l,type:V,body:null},i.prototype={constructor:i,type:Z,case1:null,case2:null};var rt=function(){function e(r){if(null==r)return null;var o,l;if(G===r.type)for(var i=0,s=r.body.length;s>i;i++)l=e(r.body[i]),o=t(o,l);if(Y===r.type){for(var a=r.body,u=r.next;null!=u;){if(Q===u.type)return e(u);if(Y!==u.type)return console.error("Ast Exception: next should be a symbol/function ref"),null;a+="."+u.body,u=u.next}return a}switch(r.type){case K:case V:case Z:l=e(r.body),o=t(o,l)}if(Z===r.type&&(l=e(b.case1),o=t(o,l),l=e(b.case2),o=t(o,l)),Q===r.type){for(var i=0,s=r.arguments.length;s>i;i++)l=e(r.arguments[i]),o=t(o,l);l=null;var c=r;e:for(;c=c.parent;)switch(c.type){case Y:l=c.body+(null==l?"":"."+l);break;case G:case K:break e;default:l=null;break e}null!=l&&(o=t(o,l)),r.next&&(l=e(r.next),o=t(o,{accessor:n(r),ref:l}))}return o}function t(e,t){if(null==e)return t;if(null==t)return e;if(("object"!=typeof e||null==e.length)&&(e=[e]),"object"!=typeof t||null==t.length)return-1===e.indexOf(t)&&e.push(t),e;for(var n=0,r=t.length;r>n;n++)-1===e.indexOf(t[n])&&e.push(t[n]);return e}function n(e){var t=e;e:for(;t.parent;){switch(t.parent.type){case G:case K:break e}t=t.parent}return r(t,e.next)}function r(e,t){if(e===t||null==e)return null;if("object"!=typeof e)return e;if(null!=e.length&&"function"==typeof e.splice){for(var n=[],o=0,l=e.length;l>o;o++)n[o]=r(e[o],t);return n}var i={};for(var s in e)null!=e[s]&&"parent"!==s&&(i[s]=r(e[s],t));return i}return function(t){return"string"==typeof t&&(t=m(t)),e(t)}}();return{parse:m,eval:v,varRefs:rt}}(),ModelUtils={condition:ConditionUtil.condition,expression:function(e,t,n,r,o){return ExpressionUtil.eval(e,t,n,o)}},CustomAttributes={"class":null,id:null,style:null,name:null,type:null},CustomTags={div:null,span:null,input:null,button:null,textarea:null,select:null,option:null,h1:null,h2:null,h3:null,h4:null,h5:null,h6:null,a:null,p:null,img:null,table:null,td:null,tr:null,pre:null,ul:null,li:null,ol:null,i:null,b:null,strong:null,form:null},Dom={NODE:1,TEXTNODE:2,FRAGMENT:3,COMPONENT:4,CONTROLLER:9,SET:10,Node:Node,TextNode:TextNode,Fragment:Fragment,Component:Component};Node.prototype={constructor:Node,type:Dom.NODE,tagName:null,parent:null,attr:null,nodes:null,__single:null},TextNode.prototype={type:Dom.TEXTNODE,content:null,parent:null},Fragment.prototype={constructor:Fragment,type:Dom.FRAGMENT,nodes:null},Component.prototype={constructor:Component,type:Dom.COMPONENT,parent:null,attr:null,controller:null,nodes:null,components:null};var Parser=function(e,t,n,r){function o(e){for(var t=-1;-1!==(t=e.indexOf(i,t))&&e.charCodeAt(t+1)!==u;)t++;if(-1===t)return e;for(var n,r=[],o=0,l=0;;){if(n=e.indexOf(s,t+2),-1===n)break;for(r[l++]=o===t?"":e.substring(o,t),r[l++]=e.substring(t+2,n),o=t=n+1;-1!==(t=e.indexOf(i,t))&&e.charCodeAt(t+1)!==u;)t++;if(-1===t)break}return e.length>o&&(r[l]=e.substring(o)),e=null,function(e,t,n,o,l,i){if(null==e){for(var s,a="",u=0,c=r.length;c>u;u++)s=r[u],a+=1===u%2?"~["+s+"]":s;return a}return util_interpolate(r,e,t,n,o,l,i)}}function l(e,t,n,r){var o={2:"tag",3:"tag",5:"attribute key",6:"attribute value",8:"literal"}[n],l=e.substring(0,t).split("\n"),i=l.length,s=l[i-1].length,a=["Mask - Unexpected:",r,"at(",i,":",s,") [ in",o,"]"];console.error(a.join(" "),{stopped:e.substring(t),template:e})}var i="~",s="]",a=126,u=91,c=93;return{parse:function(i){for(var s,f,d,p,h,g,m,v=new n,y=v,b=2,x=3,C=0,N=i.length,w=2,k=3,O=5,A=6,T=7,E=8,_=9;;)if(N>C&&33>(g=i.charCodeAt(C)))C++;else if(47!==g||47!==i.charCodeAt(C+1)){if(x===O&&(null!=s&&(v.attr["class"]=o(s),s=null),null!=d&&(v.attr[d]=d,d=null,f=null)),null!=f){if(b===O)null==d?d=f:p=f,null!=d&&null!=p&&("class"!==d?v.attr[d]=p:s=null==s?p:s+" "+p,d=null,p=null);else if(x===k)h=null!=CustomTags[f]?new r(f,v,CustomTags[f]):new e(f,v),null==v.nodes?v.nodes=[h]:v.nodes.push(h),v=h,b=O;else if(x===E){if(h=new t(f,v),null==v.nodes?v.nodes=[h]:v.nodes.push(h),v.__single===!0)do v=v.parent;while(null!=v&&null!=v.__single);b=w}f=null}if(C>=N){b===O&&(null!=s&&(v.attr["class"]=o(s)),null!=d&&(v.attr[d]=d));break}if(b===_){for(v=v.parent;null!=v&&null!=v.__single;)v=v.parent;b=w}switch(g){case 123:x=b,b=w,C++;continue;case 62:x=b,b=w,C++,v.__single=!0;continue;case 59:if(null!=v.nodes){C++;continue}case 125:C++,x=b,b=_;continue;case 39:case 34:b===A?b=O:x=b=E,C++;var j,R=!1,D=!1,I=39===g?"'":'"';for(m=C;(j=i.indexOf(I,C))>-1&&(C=j,92===i.charCodeAt(j-1));)R=!0,C++;m===C&&124===i.charCodeAt(C+1)&&(D=!0,m=C+2,C=j=i.indexOf("|"+I+I,m),-1===C&&(C=N)),f=i.substring(m,C),R===!0&&(f=f.replace(regexpEscapedChar[I],I)),f=o(f),C+=D?3:1;continue}if(b===w){if(x=k,b=k,46===g||35===g){f="div";continue}}else if(b===O)if(46===g)C++,d="class",b=T;else if(35===g)C++,d="id",b=T;else{if(61===g){C++,b=A;continue}if(null!=d){f=d;continue}}(b===A||b===T)&&(x=b,b=O);var S=null;for(m=C;N>C;){if(g=i.charCodeAt(C),g===a&&i.charCodeAt(C+1)===u){S=!0,++C;do g=i.charCodeAt(++C);while(g!==c&&N>C)}if(39===g||34===g||47===g||60===g||44===g){l(i,C,b,String.fromCharCode(g));break}if(x!==A&&(46===g||35===g))break;if(61===g||62===g||123===g||33>g||59===g)break;C++}if(f=i.substring(m,C),!f){l(i,C,b,"*EMPTY*");break}if(S===!0&&b===k){l(i,C,b,"Tag Names cannt be interpolated (in dev)");break}S===!0&&(b===O&&"class"===d)==!1&&(f=o(f))}else for(C++;10!==g&&13!==g&&N>C;)g=i.charCodeAt(++C);return null!=v.parent&&v.parent!==y&&v.parent.__single!==!0&&null!=v.nodes&&console.warn("Mask - ",v.parent.tagName,JSON.stringify(v.parent.attr),"was not proper closed."),1===y.nodes.length?y.nodes[0]:y},cleanObject:function(e){if(e instanceof Array){for(var t=0;e.length>t;t++)this.cleanObject(e[t]);return e}return delete e.parent,delete e.__single,null!=e.nodes&&this.cleanObject(e.nodes),e},setInterpolationQuotes:function(e,t){return e&&2===e.length?t&&1===t.length?(a=e.charCodeAt(0),u=e.charCodeAt(1),c=t.charCodeAt(0),s=t,i=e.charAt(0),void 0):(console.error("Interpolation End must be of 1 Character"),void 0):(console.error("Interpolation Start must contain 2 Characters"),void 0)}}}(Node,TextNode,Fragment,Component),builder_build=function(){function e(e,r,l){if(l=n(l),null==l.components||0===l.components.length)return o(e);var i=e.firstChild,a=l.ID||(l.ID=Date.now()),u="<script type='text/javascript'>("+(""+t)+"("+JSON.stringify(l)+", "+(null!=r?JSON.stringify(r):"null")+")); </script>";if(i&&i.nodeType===Dom.DOCTYPE){var c=i.nextNode;if(c){for(var f=c.firstChild;f&&"body"!==f.tagName;)f=f.nextNode;f?f.appendChild(new s(u)):console.warn("Body not found")}return o(e)}return"<script type='mask/html-template-start' id='mask-htmltemplate-"+a+"'></script>"+o(e)+"<script type='mask/html-template-end' name='mask-htmltemplate-"+a+"'></script>"+u}function t(e,n){function r(e,t,n){if(null==n&&(n=[]),e instanceof Array){for(var o,l=0,i=e.length;i>l;l++)o=e[l],r(o,t,n);return n}e.getAttribute("x-compo-id")===t&&n.push(e);var s=f.querySelectorAll('[x-compo-id="'+t+'"]');if(s.length)for(var a=n.length,l=0,i=s.length;i>l;l++)n[a++]=s[l];return n}function o(e,n,o,l){var i,s;if(e.compoName){var a=mask.getHandler(e.compoName);if(null==a)return console.error("Component Handler was not loaded:",e.compoName),void 0;i="function"==typeof a?new a(n):a,i.attr={},"function"==typeof i.renderStart&&i.renderStart(n),s=r(l,e.ID),i.ID=e.ID,"function"==typeof i.renderEnd&&i.renderEnd(s,n),null==o.components&&(o.components=[]),o.components.push(i)}if(e.components)for(var u,c=i||o,f=s&&s.length?s:l,d=0,p=e.components.length;p>d;d++)u=e.components[d],t(u,n,c,f)}var l,i={components:[]},s="mask-htmltemplate-"+e.ID,a=f.getElementById(s);if(null!=a){var u=f.getElementsByName(s)[0];if(null==a||null==u)return console.error("Invalid node range to initialize mask components"),void 0;for(var c=[],d=a.nextSibling;null!=d&&d!=u;)c.push(d),d=d.nextSibling;l=c}else l=f.body;for(var p,h=0,g=e.components.length;g>h;h++)p=e.components[h],o(p,n,i,l);Compo!==void 0&&Compo.signal.emitIn(i,"domInsert")}function n(e,t){if(null==t&&(t={}),t.compoName=e.compoName,t.ID=e.ID,e.components){for(var r,o=[],l=e.components,i=0,s=l.length;s>i;i++)r=l[i],o.push(n(r));t.components=o}return t}function r(e){return null==this.firstChild?(this.firstChild=this.lastChild=e,void 0):(this.lastChild.nextNode=e,this.lastChild=e,void 0)}function o(e){var t=e.nodeType,n="";if(Dom.FRAGMENT===t){for(e=e.firstChild;null!=e;)n+=o(e),e=e.nextNode;return n}if(Dom.DOCTYPE===t)return e.doctype;if(Dom.NODE===t){var r,l=e.tagName,i=e.attributes;n="<"+l;for(var s in i)r=i[s],n+=" "+s+'="'+("string"==typeof r?r.replace(/"/g,'\\"'):r)+'"';if(1===c[l])return n+="/>";for(n+=">",e=e.firstChild;null!=e;)n+=o(e),e=e.nextNode;return n+"</"+l+">"}return Dom.TEXTNODE===t?e.textContent:(console.error("Unknown node Type",t,e.tagName,e.textContent,null==e.firstChild),"")}function l(){}function i(e){this.tagName=e,this.attributes={}}function s(e){this.textContent=e}function a(e){this.doctype=e}function u(e,t,n,r,o){if(null==e)return r;var l,i,s,a,c,p,h=e.type;if(10===h||e instanceof Array){for(s=0,a=e.length;a>s;s++)u(e[s],t,n,r,o);return r}if(null==h&&(null!=e.tagName?h=1:null!=e.content&&(h=2)),1===h){var g,m=e.tagName,v=e.attr;try{g=f.createElement(m)}catch(y){return console.error(m,"element cannot be created. If this should be a custom handler tag, then controller is not defined"),void 0}null!=i&&(i.push(g),i=null,v["x-compo-id"]=o.ID);for(c in v)"function"==typeof v[c]?(p=v[c]("attr",t,n,g,o,c),p instanceof Array&&(p=p.join(""))):p=v[c],p&&("function"==typeof CustomAttributes[c]?CustomAttributes[c](e,p,t,n,g,o):g.setAttribute(c,p));null!=r&&r.appendChild(g),r=g}if(2===h){var b,x,C,N;if(x=e.content,"function"==typeof x)if(C=x("node",t,n,r,o),"string"==typeof C)r.appendChild(f.createTextNode(C));else{for(N="",s=0,a=C.length;a>s;s++)if(b=C[s],"object"!=typeof b)N+=b;else{if(""!==N&&(r.appendChild(f.createTextNode(N)),N=""),null==b.nodeType){N+=""+b;continue}r.appendChild(b)}""!==N&&r.appendChild(f.createTextNode(N))}else r.appendChild(f.createTextNode(x));return r}if(4===h){var v,w=e.controller,k="function"==typeof w?new w(t):w;if(null!=k){k.compoName=e.tagName,k.attr=v=util_extend(k.attr,e.attr);for(c in v)"function"==typeof v[c]&&(v[c]=v[c]("attr",t,n,r,o,c));if(k.nodes=e.nodes,k.parent=o,null!=listeners&&null!=listeners.compoCreated){var O=listeners.compoCreated;for(s=0,a=O.length;a>s;s++)O[s](k,t,n,r)}"function"==typeof k.renderStart&&k.renderStart(t,n,r),null!=k.tagName&&k.tagName!==e.compoName&&(k.nodes={tagName:k.tagName,attr:k.attr,nodes:k.nodes,type:1}),e=k}if(null==o.components?o.components=[e]:o.components.push(e),o=e,o.ID=++d,l=[],null!=o.model&&(t=o.model),"function"==typeof o.render)return o.render(t,n,r),r}var A=e.nodes;if(null!=A)for(var T,E=A instanceof Array,_=E===!0?A.length:1,j=0;_>j;j++)T=E===!0?A[j]:A,4===h&&1===T.type&&(T.attr["x-compo-id"]=e.ID),u(T,t,n,r,o);return r}var c={};util_extend(Dom,{DOCTYPE:11}),l.prototype={constructor:l,nodeType:Dom.FRAGMENT,firstChild:null,lastChild:null,nextNode:null,appendChild:r},i.prototype={constructor:i,nodeType:Dom.NODE,firstChild:null,lastChild:null,nextNode:null,appendChild:r,setAttribute:function(e,t){this.attributes[e]=t},getAttribute:function(e){return this.attributes[e]}},s.prototype={constructor:s,nodeType:Dom.TEXTNODE,nextNode:null},a.prototype={constructor:a,nodeType:Dom.DOCTYPE};var f={createDocumentFragment:function(){return new l},createElement:function(e){return new i(e)},createTextNode:function(e){return new s(e)}};(function(){function e(){}CustomTags[":document"]=e,e.prototype={render:function(e,t,n){var r=this.attr,o=this.nodes,l=r.doctype||"html";delete r.doctype,n.appendChild(new a("<!DOCTYPE "+l+">"));for(var i,s,c,f,d={tagName:"html",type:Dom.NODE,attr:r,nodes:[]},p=0,h=o.length;h>p;p++)f=o[p],"head"!==f.tagName?"body"!==f.tagName?c=!0:s=f:i=f;if(null==s&&(s={nodeType:Dom.NODE,tagName:"body",nodes:[]}),null!=i&&d.nodes.push(i),null!=s&&d.nodes.push(s),c)for(var f,p=0,h=o.length;h>p;p++)f=o[p],"head"!==f.tagName&&"body"!==f.tagName&&s.nodes.push(f);var g=this.parent;return g.components=[],u(d,e,t,n,g),n}}})();var d=0;return function(t,n,r){var o=new l,i=new Component;return u(t,n,r,o,i),e(o,n,i)}}(),cache={},Mask={render:function(e,t,n,r,o){return null!=r&&"function"!=typeof r.appendChild&&(console.error(".render(template[, model, cntx, container, controller]","Container should implement .appendChild method"),console.warn("Args:",arguments)),"string"==typeof e&&(e=hasOwnProp.call(cache,e)?cache[e]:cache[e]=Parser.parse(e)),builder_build(e,t,n,r,o)},compile:Parser.parse,parse:Parser.parse,build:builder_build,registerHandler:function(e,t){CustomTags[e]=t},getHandler:function(e){return null!=e?CustomTags[e]:CustomTags},registerAttrHandler:function(e,t){CustomAttributes[e]=t},registerUtility:function(e,t){ModelUtils[e]=t},clearCache:function(e){"string"==typeof e?delete cache[e]:cache={}},ValueUtils:{condition:ConditionUtil.condition,out:ConditionUtil},Utils:{Condition:ConditionUtil,Expression:ExpressionUtil,getProperty:util_getProperty},Dom:Dom,plugin:function(source){eval(source)},on:function(e,t){null==listeners&&(listeners={}),(listeners[e]||(listeners[e]=[])).push(t)},delegateReload:function(){},setInterpolationQuotes:Parser.setInterpolationQuotes};Mask.renderDom=Mask.render,function(e){var t=function(){function t(e){for(var t="";e--;)t+=" ";return t}function n(e,n,o){var l,i;null==n&&(n=0),null==o&&(l=!0,o=[]);var s=o.length;if(e.type===f.FRAGMENT&&(e=e.nodes),e instanceof Array)for(i=0;e.length>i;i++)r(e[i],n,o);else r(e,n,o);var a=t(n);for(i=s;o.length>i;i++)o[i]=a+o[i];return l?o.join(0===c?"":"\n"):void 0}function r(e,t,r){return"string"==typeof e.content?(r.push(a(e.content)),void 0):"function"==typeof e.content?(r.push(a(e.content())),void 0):l(e)?(r.push(o(e)+";"),void 0):i(e)?(r.push(o(e)+" > "),n(s(e),c,r),void 0):(r.push(o(e)+"{"),n(e.nodes,c,r),r.push("}"),void 0)}function o(e){var t=e.tagName,n=e.attr.id||"",r=e.attr["class"]||"";"function"==typeof n&&(n=n()),"function"==typeof r&&(r=r()),n&&(n=-1!==n.indexOf(" ")?"":"#"+n),r&&(r="."+r.split(" ").join("."));var o="";for(var l in e.attr)if("id"!==l&&"class"!==l){var i=e.attr[l];"function"==typeof i&&(i=i()),(u===!1||/\s/.test(i))&&(i=a(i)),o+=" "+l+"="+i}return"div"===t&&(n||r)&&(t=""),t+n+r+o}function l(e){return null==e.nodes||e.nodes instanceof Array&&0===e.nodes.length}function i(e){return e.nodes&&(e.nodes instanceof Array==!1||1===e.nodes.length)}function s(e){return e.nodes instanceof Array?e.nodes[0]:e.nodes}function a(e){return-1===e.indexOf('"')?'"'+e.trim()+'"':-1===e.indexOf("'")?"'"+e.trim()+"'":'"'+e.replace(/"/g,'\\"').trim()+'"'}var u,c,f=e.Dom;return function(t,r){return"string"==typeof t&&(t=e.parse(t)),"number"==typeof r?(c=r,u=0===c):(c=r&&r.indent||4,u=0===c||r&&r.minimizeAttributes),n(t)}}();e.stringify=t}(Mask),function(e){function t(){this.attr={"debugger":null,use:null,repeat:null,"if":null,"else":null,each:null,log:null}}function n(e,t,n,r){null==e.nodes&&Compo!==void 0&&Compo.ensureTemplate(e);var i=util_getProperty(t,e.attr.foreach||e.attr.each),s=e.nodes,a=e.attr.index||"index";if(e.nodes=[],e.template=s,e.container=r,null!=i&&"object"==typeof i&&null!=i.length){for(var u,c=0,f=i.length;f>c;c++)u=o(s,i[c],r,e),u[a]=c,e.nodes[c]=u;for(var d in l)e[d]=l[d]}}function r(e,t,n,r){var l,i=e.attr.repeat.split(".."),s=+i[0],a=+i[1],u=e.nodes;(isNaN(s)||isNaN(a))&&console.error("Repeat attribute(from..to) invalid",e.attr.repeat),e.nodes=[];for(var c=0;a>s;s++)l=o(u,t,r,e),l._repeatIndex=s,e.nodes[c++]=l}function o(e,t,n,r){var o=new Component;return o.nodes=e,o.model=t,o.container=n,o.parent=r,o}e.registerHandler("%",t),t.prototype={constructor:t,renderStart:function(e,t,o){var l=this.attr;if(null!=l.use)return this.model=util_getProperty(e,l.use),void 0;if(null==l["debugger"]){if(null!=l.log){var i=l.log,s=util_getProperty(e,i);return console.log("Key: %s, Value: %s",i,s),void 0}if(null!=l.repeat&&r(this,e,t,o),this.model=e,null!=l["if"]){var a=l["if"];return this.state=ConditionUtil.isCondition(a,e),this.state||(this.nodes=null),void 0}if(null!=l["else"]){var u=this.parent.components,c=u&&u[u.length-1];return null!=c&&"%"===c.compoName&&null!=c.attr["if"]?(c.state&&(this.nodes=null),void 0):(console.error("Previous Node should be \"% if='condition'\"",c,this.parent),void 0)}(null!=l.each||null!=l.foreach)&&n(this,e,t,o)}},render:null};var l={append:function(t){var n;n=new Component,n.nodes=this.template,n.model=t,e.render(n,t,null,this.container,this)}}}(Mask),function(e){function t(){}function n(){}function r(){}var o={};e.templates=o,e.registerHandler(":template",t),t.prototype.render=function(){return null==this.attr.id?(console.warn("Template Should be defined with ID attribute for future lookup"),void 0):(o[this.attr.id]=this.nodes,void 0)},e.registerHandler(":import",n),n.prototype={constructor:n,attr:null,template:null,renderStart:function(){if(this.attr.id){if(this.nodes=this.template,null==this.nodes&&(this.nodes=o[this.attr.id]),null==this.nodes){for(var e,t=this,n=":template[id="+this.attr.id+"]";null==e&&null!=(t=t.parent);)null!=t.nodes&&(e=jmask(t.nodes).filter(n).get(0));null!=e&&(this.nodes=e.nodes)}null==this.nodes&&console.warn("Template could be not imported",this.attr.id)}}},e.registerHandler(":html",r),r.prototype.render=function(e,t,n){var r=jmask(this.nodes).text(e,t,this);return r?(n.insertAdjacentHTML("beforeend",r),void 0):(console.warn("No HTML for node",this),void 0)}}(Mask);var Compo=exports.Compo=function(e){function t(e,t){if(null==e&&(e={}),null==t)return e;for(var n in t)e[n]=t[n];return e}function n(e){var t={};for(var n in e)t[n]=e[n];return t}function r(e,t,n){if(null==e&&console.warn("selector is null for type",t),"object"==typeof e)return e;var r,o,l;if(null==r)switch(e[0]){case"#":r="id",e=e.substring(1),o="attr";break;case".":r="class",e=RegExp("\\b"+e.substring(1)+"\\b"),o="attr";break;default:r=t===f.SET?"tagName":"compoName"}return l="up"===n?"parent":t===f.SET?"nodes":"components",{key:r,prop:o,selector:e,nextKey:l}}function o(e,t,n){"string"==typeof t&&(null==n&&(n=f[e.compoName?"CONTROLLER":"SET"]),t=r(t,n));var o=t.prop?e[t.prop]:e;if(null==o)return!1;if(null!=t.selector.test){if(t.selector.test(o[t.key]))return!0}else if(o[t.key]==t.selector)return!0;return!1}function l(e,t){if(e instanceof Array){for(var n,r=0,i=e.length;i>r;r++){n=e[r];var s=l(n,t);if(null!=s)return s}return null}return o(e,t)===!0?e:(e=e[t.nextKey])&&l(e,t)}function i(e,t,n){return null!=e.addEventListener?(e.addEventListener(t,n,!1),void 0):(e.attachEvent&&e.attachEvent("on"+t,n),void 0)}function s(e,t){return e.filter(t).add(e.find(t))}function a(e,t,n,r){return null==n?e.on(t,r):(e.on(t,n,r),e.filter(n).on(t,r),e)}function u(){}var c=global.jQuery||global.Zepto||global.$,f=e.Dom,d=Array.prototype.slice;null!=document&&null==c&&console.warn("jQuery / Zepto etc. was not loaded before compo.js, please use Compo.config.setDOMLibrary to define dom engine");var p={select:function(e,t){for(var n in t){var r=t[n],o=null,l=null;if(r instanceof Array&&(l=r[0],o=r.splice(1)),"string"==typeof r&&(l=r),null==r||null==l)return console.error("Unknown component child",n,t[n]),console.warn("Is this object shared within multiple compo classes? Define it in constructor!"),void 0;var i=l.indexOf(":"),s=l.substring(0,i);s=b.config.selectors[s],null==s?e.compos[n]=e.$[0].querySelector(l):(l=l.substring(++i).trim(),e.compos[n]=s(e,l));var a=e.compos[n];null!=o&&(null!=a.$&&(a=a.$),h.on(e,o,a))}}},h={on:function(e,t,n){null==n&&(n=e.$);for(var r,o=t instanceof Array,l=o?t.length:1,i=0;o?l>i:1>i;i++)if(r=o?t[i]:t,r instanceof Array)null!=g&&(r[0]=g(r[0])),n.on.apply(n,r);else for(var s in r){var u,c,f="string"==typeof r[s]?e[r[s]]:r[s],d=s.indexOf(":");-1!==d?(u=s.substring(0,d),c=s.substring(d+1).trim()):u=s,null!=g&&(u=g(u)),a(n,u,c,f.bind(e))}}},g=null,m=function(){var e=function(){if(null==document)return!1;if("createTouch"in document)return!0;try{return!!document.createEvent("TouchEvent").initTouchEvent}catch(e){return!1}}();return{touch:function(t){return e===!1?t:"click"===t?"touchend":"mousedown"===t?"touchstart":"mouseup"===t?"touchend":"mousemove"===t?"touchmove":t}}}(),v=function(){function t(e,t){return function(){new s(e).emit(t)}}function n(e,t){return null==t.pipes[e]?(console.error("Controller has no pipes to be added to collection",e,t),void 0):(null==a[e]&&(a[e]=[]),a[e].push(t),void 0)}function r(e,t){for(var n=a[e],r=n.length;--r;)n[r]===t&&(n.splice(r,1),r++)}function o(){var e=this,t=e.pipes;for(var n in t)r(n,e)}function l(e){var t=e.pipes;if(null==t)return console.error("Controller has no pipes",e),void 0;for(var r in t)n(r,e);b.attachDisposer(e,o.bind(e))}function s(e){return this instanceof s==!1?new s(e):(this.pipeName=e,this)}e.registerAttrHandler("x-pipe-signal",function(e,n,r,o,l){for(var s,a=n.split(";"),u=0,c=a.length;c>u;u++)if(s=a[u].trim(),""!==s){var f,d,p=s.substring(0,s.indexOf(":")),h=s.substring(s.indexOf(":")+1).trim(),m=h.indexOf(".");if(-1===m)return console.error('define pipeName "click: pipeName.pipeSignal"'),void 0;f=h.substring(0,m),d=h.substring(++m);var v=t(f,d);!p&&console.error("Signal: event type is not set",n),null!=g&&(p=g(p)),i(l,p,v)}});var a={};return s.prototype={constructor:s,emit:function(e,t){var n=a[this.pipeName],r=this.pipeName;if(null==n)return console.warn("Pipe.emit: No signals were bound to a Pipe",r),void 0;for(var o,l,i,s,u=n.length;-1!==--u;)o=n[u],l=o.pipes[r],null!=l&&(i=l[e],"function"==typeof i&&(i.apply(o,t),s=!0));
s!==!0&&console.warn("No piped slot found for a signal",e,r)}},s.addController=l,s.removeController=o,{addController:l,removeController:o,emit:function(e,t,n){s(e).emit(t,n)},pipe:s}}(),y=function(){var e={};return{create:function(t){return null==t.ID?(console.warn("Component should have an ID"),void 0):(e[t.ID]=t,void 0)},resolveCompo:function(t){if(null==t)return null;var n,r,o;do{if(r=t.getAttribute("x-compo-id"),r&&(null==n&&(n=r),o=e[r],null!=o&&(o=b.find(o,{key:"ID",selector:n,nextKey:"components"}),null!=o)))return o;t=t.parentNode}while(t&&1===t.nodeType);return n&&console.warn("No controller for ID",n),null},removeCompo:function(t){null!=t.ID&&delete e[t.ID]}}}(),b=function(){function o(e){if(this instanceof o)return null;var t;null==e&&(e={}),e.hasOwnProperty("constructor")&&(t=e.constructor),t=x(t,e),null==t&&(t=function(){});for(var n in C)null==e[n]&&(e[n]=C[n]),e["base_"+n]=C[n];return t.prototype=e,e=null,t}function i(e){null!=e.dispose&&e.dispose(),y.removeCompo(e);var t=0,n=e.components,r=n&&n.length;if(r)for(;r>t;t++)i(n[t])}function a(t){if(null==t.nodes){null!=t.attr.template&&(t.template=t.attr.template,delete t.attr.template);var n=t.template;if(null!=typeof n){if("string"==typeof n){if("#"===n[0]){var r=document.getElementById(n.substring(1));if(null==r)return console.error("Template holder not found by id:",n),void 0;n=r.innerHTML}n=e.parse(n)}"object"==typeof n&&(t.nodes=n)}}}function u(){var e=[];return e.appendChild=function(e){this.push(e)},e}function b(e,t){if("function"==typeof e.dispose){var n=e.dispose;return e.dispose=function(){t.call(this),n.call(this)},void 0}e.dispose=t}function x(e,t){var r=t.compos,o=t.pipes;return null==r&&null==o?e:function(){null!=r&&(this.compos=n(r)),null!=o&&v.addController(this),"function"==typeof e&&e.call(this)}}t(o,{create:function(e){var t;null==e&&(e={}),e.hasOwnProperty("constructor")&&(t=e.constructor),null==t&&(t=function(){});for(var n in C)null==e[n]&&(e[n]=C[n]),e["base_"+n]=C[n];return t.prototype=e,t},render:function(t,n,r,o){a(t);var l=[];return e.render(null==t.tagName?t.nodes:t,n,r,o,t,l),t.$=c(l),null!=t.events&&h.on(t,t.events),null!=t.compos&&p.select(t,t.compos),t},initialize:function(t,n,r,l,i){null==l&&(r&&null!=r.nodeType?(l=r,r=null):n&&null!=n.nodeType&&(l=n,n=null)),"string"==typeof t&&(t=e.getHandler(t),t||console.error("Compo not found:",t));var s={controller:t,type:f.COMPONENT};null==i&&null!=l&&(i=y.resolveCompo(l)),null==i&&(i=new f.Component);var a=e.render(s,n,r,null,i),u=i.components[i.components.length-1];return null!=l&&(l.appendChild(a),o.signal.emitIn(u,"domInsert")),u},dispose:function(e){"function"==typeof e.dispose&&e.dispose();var t=0,n=e.components,r=n&&n.length;if(r)for(;r>t;t++)o.dispose(n[t])},find:function(e,t){return l(e,r(t,f.CONTROLLER,"down"))},closest:function(e,t){return l(e,r(t,f.CONTROLLER,"up"))},ensureTemplate:a,attachDisposer:b,config:{selectors:{$:function(e,t){var n=s(e.$,t);return 0===n.length&&console.error("Compo Selector - element not found -",t,e),n},compo:function(e,t){var n=o.find(e,t);return null==n&&console.error("Compo Selector - component not found -",t,e),n}},setDOMLibrary:function(e){c=e},eventDecorator:function(e){return"function"==typeof e?(g=e,void 0):"string"==typeof e?(g=m[e],void 0):"boolean"==typeof e&&e===!1?(g=null,void 0):void 0}},pipe:v.pipe});var C={type:f.CONTROLLER,tagName:null,compoName:null,nodes:null,attr:null,slots:null,pipes:null,onRenderStart:null,onRenderEnd:null,render:null,renderStart:function(e,t,n){1===arguments.length&&null!=e&&e instanceof Array==!1&&null!=e[0]&&(e=arguments[0][0],t=arguments[0][1],n=arguments[0][2]),"function"==typeof this.onRenderStart&&this.onRenderStart(e,t,n),null==this.model&&(this.model=e),null==this.nodes&&a(this)},renderEnd:function(e,t,n,r){1===arguments.length&&e instanceof Array==!1&&(e=arguments[0][0],t=arguments[0][1],n=arguments[0][2],r=arguments[0][3]),y.create(this,e),this.$=c(e),null!=this.events&&h.on(this,this.events),null!=this.compos&&p.select(this,this.compos),"function"==typeof this.onRenderEnd&&this.onRenderEnd(e,t,n,r)},appendTo:function(e){var t;if(t="string"==typeof e?document.querySelector(e):e,null==t)return console.warn("Compo.appendTo: parent is undefined. Args:",arguments),this;for(var n=0;this.$.length>n;n++)t.appendChild(this.$[n]);return this.emitIn("domInsert"),this},append:function(t,n,o){var i;if(null==this.$){var s="string"==typeof t?e.compile(t):t;return i=o?l(this,r(o,f.CONTROLLER,"down")):this,null==i.nodes?(this.nodes=s,this):(i.nodes=[this.nodes,s],this)}var a=e.render(t,n,null,u(),this);i=o?this.$.find(o):this.$;for(var c=0;a.length>c;c++)i.append(a[c]);return this.emitIn("domInsert"),this},find:function(e){return l(this,r(e,f.CONTROLLER,"down"))},closest:function(e){return l(this,r(e,f.CONTROLLER,"up"))},on:function(){var e=Array.prototype.slice.call(arguments);return 3>arguments.length?(console.error("Invalid Arguments Exception @use .on(type,selector,fn)"),this):(null!=this.$&&h.on(this,[e]),null==this.events?this.events=[e]:this.events instanceof Array?this.events.push(e):this.events=[e,this.events],this)},remove:function(){null!=this.$&&(this.$.remove(),this.$=null),i(this);var e=this.parent&&this.parent.components;if(null!=e){var t=e.indexOf(this);if(-1===t)return console.warn("Compo::remove - parent doesnt contains me",this),this;e.splice(t,1)}return this},slotState:function(e,t){o.slot.toggle(this,e,t)},signalState:function(e,t){o.signal.toggle(this,e,t)},emitOut:function(e){o.signal.emitOut(this,e,this,arguments.length>1?d.call(arguments,1):null)},emitIn:function(e){o.signal.emitIn(this,e,this,arguments.length>1?d.call(arguments,1):null)}};return o.prototype=C,o}();return function(){function n(e,t,r,o,l){if(null!=e){if(null!=e.slots&&"function"==typeof e.slots[t]){var i=e.slots[t],s=null!=e.slots.__disabled&&e.slots.__disabled[t];if(s!==!0){var a=null==o?i.call(e,r):i.apply(e,[r].concat(o));if(a===!1)return}}if(-1===l&&null!=e.parent&&n(e.parent,t,r,o,l),1===l&&null!=e.components)for(var u=0,c=e.components.length;c>u;u++)n(e.components[u],t,r,o,l)}}function r(e,t,n,o){if(null==e)return!1;var l=e.slots;if(null!=l&&null!=l[t]&&("string"==typeof l[t]&&(l[t]=e[l[t]]),"function"==typeof l[t])){if(o!==!0)return!0;if(null==l.__disabled||l.__disabled[t]!==!0)return!0}if(-1===n&&null!=e.parent)return r(e.parent,t,n);if(1===n&&null!=e.components)for(var i=0,s=e.components.length;s>i;i++)if(r(e.components[i],t,n))return!0;return!1}function o(e,t){return r(e,t,-1)===!1?null:function(r){n(e,t,r,null,-1)}}function l(e,t,n){var r=e.slots;null!=r&&r.hasOwnProperty(t)!==!1&&(null==r.__disabled&&(r.__disabled={}),r.__disabled[t]=n===!1)}function s(e,t,n){if(l(e,t,n),null!=e.components)for(var r=0,o=e.components.length;o>r;r++)s(e.components[r],t,n)}function a(e,t,n){return null==e.$?(console.warn("Controller has no elements to toggle state"),void 0):(c().add(e.$.filter("[data-signals]")).add(e.$.find("[data-signals]")).each(function(e,r){var o=r.getAttribute("data-signals");null!=o&&-1!==o.indexOf(t)&&r[n===!0?"removeAttribute":"setAttribute"]("disabled","disabled")}),void 0)}function u(e,t,n){for(var r=e,o=e;null!=(r=r.parent);)l(r,t,n),null!=r.$&&0!==r.$.length&&(o=r);s(e,t,n),a(o,t,n)}function f(e,t,n){l(e,t,n),(n||!r(e,t,-1,!0)&&!r(e,t,1,!0))&&a(e,t,n)}e.registerAttrHandler("x-signal",function(e,t,n,r,l,s){for(var a,u=t.split(";"),c="",f=0,d=u.length;d>f;f++)if(a=u[f].trim(),""!==a){var p=a.substring(0,a.indexOf(":")),h=a.substring(a.indexOf(":")+1).trim(),m=o(s,h);!p&&console.error("Signal: event type is not set",t),m&&(null!=g&&(p=g(p)),c+=","+h+",",i(l,p,m)),!m&&console.warn("No slot found for signal",h,s)}""!==c&&l.setAttribute("data-signals",c)}),t(b,{signal:{toggle:u,emitOut:function(e,t,r,o){n(e,t,r,o,-1)},emitIn:function(e,t,r,o){n(e,t,r,o,1)},enable:function(e,t){u(e,t,!0)},disable:function(e,t){u(e,t,!1)}},slot:{toggle:f,enable:function(e,t){f(e,t,!0)},disable:function(e,t){f(e,t,!1)},invoke:function(e,t,n,r){var o=e.slots;return null==o||"function"!=typeof o[t]?(console.error("Slot not found",t,e),null):null==r?o[t].call(e,n):o[t].apply(e,[n].concat(r))}}})}(),function(){null!=c&&null!=c.fn&&(c.fn.compo=function(e){if(0===this.length)return null;var t=y.resolveCompo(this[0]);return null==e?t:l(t,r(e,f.CONTROLLER,"up"))},c.fn.model=function(e){var t=this.compo(e);if(null==t)return null;for(var n=t.model;null==n&&t.parent;)t=t.parent,n=t.model;return n})}(),e.registerHandler(":slot",u),u.prototype={constructor:u,renderEnd:function(){this.slots={},this.expression=this.attr.on,this.slots[this.attr.signal]=this.handle},handle:function(){var t=this.expression;e.Utils.Expression.eval(t,this.model,global,this)}},b}(Mask),jmask=exports.jmask=function(e){function t(e,t){if(null==e&&(e={}),null==t)return e;for(var n in t)e[n]=t[n];return e}function n(e,t){for(var n=0,r=e.length;r>n;n++)t(e[n],n)}function r(e,t){if(null==e)return console.error("Can not remove myself from parent",t),void 0;var n=e.indexOf(t);return-1===n?(console.error("Can not remove myself from parent",t,n),void 0):(e.splice(n,1),void 0)}function o(e,t,n){if(null==e&&console.warn("selector is null for type",t),"object"==typeof e)return e;var r,o,i,s,a,u,c,f,d,h=0,g=e.length;for(r="up"===n?"parent":t===p.SET?"nodes":"components";g>h;)a=e.charCodeAt(h),33>a||(u=l(e,h+1,g),46===a?(o="class",i="attr",s=RegExp("\\b"+e.substring(h+1,u)+"\\b")):35===a?(o="id",i="attr",s=e.substring(h+1,u)):91===a?(f=e.indexOf("=",h),-1===f&&console.error('Attribute Selector: should contain "="'),i="attr",o=e.substring(h+1,f),a=e.charCodeAt(f+1),d=34===a||39===a?2:1,s=e.substring(f+d,u-d+1),u++):(i=null,o=t===p.SET?"tagName":"compoName",s=e.substring(h,u)),h=u,null!=c?(null==c.filters&&(c.filters=[]),c.filters.push({key:o,selector:s,prop:i})):c={key:o,prop:i,selector:s,nextKey:r,filters:null});return c}function l(e,t,n){for(var r,o=!1,l=!1;n>t&&(r=e.charCodeAt(t),(34===r||39===r)&&(o=!o),92===r&&(l=!l),!(46===r||35===r||91===r||93===r||33>r)||o===!0&&l===!0);)t++;return t}function i(e,t,n){"string"==typeof t&&(null==n&&(n=p[e.compoName?"CONTROLLER":"SET"]),t=o(t,n));var r=t.prop?e[t.prop]:e,l=!1;if(null==r)return!1;if(null!=t.selector.test?t.selector.test(r[t.key])&&(l=!0):r[t.key]===t.selector&&(l=!0),l===!0&&null!=t.filters)for(var s,a=0,u=t.filters.length;u>a;a++)if(s=t.filters[a],i(e,s,n)===!1)return!1;return l}function s(e,t){if(null==t)return e;for(var n,r=[],o=0,l=e.length;l>o;o++)n=e[o],i(n,t)&&r.push(n);return r}function a(e,t,n){if(null==e)return n;if(null==n&&(n=[]),e instanceof Array){for(var r=0,o=e.length;o>r;r++)a(e[r],t,n);return n}i(e,t)&&n.push(e);var l=e[t.nextKey];return null!=l&&a(l,t,n),n}function u(e,n){var r={type:1,tagName:1,compoName:1,controller:1},o={parent:n};for(var l in e)1===r[l]&&(o[l]=e[l]);e.attr&&(o.attr=t({},e.attr));var i=e.nodes;if(null!=i&&i.length>0){o.nodes=[];for(var s=i instanceof Array,a=s===!0?i.length:1,c=0;a>c;c++)o.nodes[c]=u(s===!0?i[c]:i,o)}return o}function c(e){for(var t,n=e;null!=n;)t=n,n=n.nodes&&n.nodes[0];return t}function f(e,t,n,r){if(p.TEXTNODE===e.type)return"function"==typeof e.content?e.content("node",t,n,null,r):e.content;var o="";if(null!=e.nodes)for(var l,i=0,s=e.nodes.length;s>i;i++)l=e.nodes[i],o+=f(l,t,n,r);return o}function d(e){return this instanceof d==!1?new d(e):null==e?this:e.type===p.SET?e:this.add(e)}var p=e.Dom,h=e.render,g=e.parse,m=(global.Compo||e.Compo||Compo).signal.emitIn,v=function(){function e(e,n){return e===n?(t=!0,0):1}var t=!1;return function(n){var r,o,l,i;if(t=!1,n.sort(e),t===!1)return n;for(r=[],o=0,l=0,i=n.length-1;i>o;)n[o++]===n[o]&&(r[l++]=o);for(;l--;)n.splice(r[l],1);return n}}();return d.prototype={constructor:d,type:p.SET,length:0,components:null,add:function(e){var t,n;if("string"==typeof e&&(e=g(e)),e instanceof Array){for(t=0,n=e.length;n>t;t++)this.add(e[t]);return this}"function"==typeof e&&null!=e.prototype.type&&(e={controller:e,type:p.COMPONENT});var r=e.type;if(!r)return console.error("Only Mask Node/Component/NodeText/Fragment can be added to jmask set",e),this;if(r===p.FRAGMENT){var o=e.nodes;for(t=0,n=o.length;n>t;)this[this.length++]=o[t++];return this}if(r===p.CONTROLLER){if(null!=e.nodes&&e.nodes.length)for(t=e.nodes.length;0!==t;)e.nodes[--t].parent=e;null!=e.$&&(this.type=p.CONTROLLER)}return this[this.length++]=e,this},toArray:function(){return Array.prototype.slice.call(this)},render:function(e,t,n,r){if(this.components=[],1===this.length)return h(this[0],e,t,n,r||this);null==n&&(n=document.createDocumentFragment());for(var o=0,l=this.length;l>o;o++)h(this[o],e,t,n,r||this);return n},prevObject:null,end:function(){return this.prevObject||this},pushStack:function(e){var t;return t=d(e),t.prevObject=this,t},controllers:function(){return null==this.components&&console.warn("Set was not rendered"),this.pushStack(this.components||[])},mask:function(t){if(null!=t)return this.empty().append(t);if(arguments.length)return this;var n;if(0===this.length)n=new p.Node;else if(1===this.length)n=this[0];else{n=new p.Fragment;for(var r=0,o=this.length;o>r;r++)n.nodes[r]=this[r]}return e.stringify(n)},text:function(e,t,n){if("string"==typeof e){for(var r,o=[new p.TextNode(e)],l=0,i=this.length;i>l;l++)r=this[l],r.nodes=o;return this}for(var r,s="",l=0,i=this.length;i>l;l++)r=this[l],s+=f(r,e,t,n);return s}},n(["append","prepend"],function(e){d.prototype[e]=function(t){for(var n,r,o=d(t),l=0,i=this.length;i>l;l++){r=this[l],n=o.toArray();for(var s=0,a=n.length;a>s;s++)n[s].parent=r;r.nodes=null!=r.nodes?"append"===e?r.nodes.concat(n):n.concat(r.nodes):n}return this}}),n(["appendTo"],function(e){d.prototype[e]=function(e,t,n,r){return null==r&&(r=this),null!=e.nodeType&&"function"==typeof e.appendChild?(e.appendChild(this.render(t,n,null,r)),m(r,"domInsert"),this):(d(e).append(this),this)}}),function(){function e(e){for(var t,n,r=e.split(";"),o={},l=0,i=r.length;i>l;l++)n=r[l],t=n.indexOf(":"),o[n.substring(0,t).trim()]=n.substring(t+1).trim();return o}function r(e){var t=[],n=0;for(var r in e)t[n++]=r+":"+e[r];return t.join(";")}n(["add","remove","toggle","has"],function(e){d.prototype[e+"Class"]=function(t){var n,r,o,l,i,s=this.length,a=0;if("string"!=typeof t){if("remove"===e)for(;s>a;a++)this[0].attr["class"]=null;return this}for(;s>a;a++)if(l=this[a],null!=l.attr){if(i=l.attr["class"],null==i)i=t;else{for(i=" "+i+" ",null==n&&(n=t.split(" "),o=n.length),r=0;o>r;r++)if(n[r]){var u=i.indexOf(" "+n[r]+" ")>-1;if("has"!==e)u!==!1||"add"!==e&&"toggle"!==e?u!==!0||"remove"!==e&&"toggle"!==e||(i=i.replace(" "+n[r]+" "," ")):i+=n[r]+" ";else if(u)return!0}i=i.trim()}"has"!==e&&(l.attr["class"]=i)}return"has"===e?!1:this}}),n(["attr","removeAttr","prop","removeProp"],function(e){d.prototype[e]=function(t,n){if(!t)return this;for(var r,o=this.length,l=0,i=arguments.length;o>l;l++)switch(r=this[l],e){case"attr":case"prop":if(1===i){if("string"==typeof t)return r.attr[t];for(var s in t)r.attr[s]=t[s]}else 2===i&&(r.attr[t]=n);break;case"removeAttr":case"removeProp":r.attr[t]=null}return this}}),t(d.prototype,{tag:function(e){if("string"==typeof e){for(var t=0,n=this.length;n>t;t++)this[t].tagName=e;return this}return this[0]&&this[0].tagName},css:function(t,n){var o,l,i,s=arguments.length,a=this.length,u=0;if(1===s&&"string"==typeof t)return 0===a?null:"string"==typeof this[0].attr.style?e(this[0].attr.style)[t]:null;for(;a>u;u++)if(i=this[u].attr.style,"function"!=typeof i){if(1===s&&"object"==typeof t){if(null==i){this[u].attr.style=r(t);continue}o=e(i);for(l in t)o[l]=t[l];this[u].attr.style=r(o)}if(2===s){if(null==i){this[u].attr.style=t+":"+n;continue}o=e(i),o[t]=n,this[u].attr.style=r(o)}}return this}})}(),t(d.prototype,{clone:function(){for(var e=[],t=0,n=this.length;n>t;t++)e[t]=u(this[0]);return d(e)},wrap:function(e){var t,n=d(e),r=[];if(0===n.length)return console.log("Not valid wrapper",e),this;for(var o=0,l=this.length;l>o;o++)t=l>0?n.clone():n,c(t[0]).nodes=[this[o]],r[o]=t[0],null!=this[o].parent&&(this[o].parent.nodes=r[o]);return d(r)},wrapAll:function(e){var t=d(e);return 0===t.length?(console.error("Not valid wrapper",e),this):(this.parent().mask(t),c(t[0]).nodes=this.toArray(),this.pushStack(t))}}),n(["empty","remove"],function(e){d.prototype[e]=function(){for(var t,n=0,o=this.length;o>n;n++)t=this[n],"empty"!==e?"remove"!==e||null!=t.parent&&r(t.parent.nodes,t):t.nodes=null;return this}}),t(d.prototype,{each:function(e){for(var t=0,n=this.length;n>t;t++)e(this[t],t);return this},eq:function(e){return-1===e?this.slice(e):this.slice(e,e+1)},get:function(e){return 0>e?this[this.length-e]:this[e]},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments))}}),n(["filter","children","closest","parent","find","first","last"],function(e){d.prototype[e]=function(t){var n,r,l,u=[],c=null==t?null:o(t,this.type,"closest"===e?"up":"down");switch(e){case"filter":return d(s(this,c));case"children":for(n=0,l=this.length;l>n;n++)r=this[n],null!=r.nodes&&(u=u.concat(null==c?r.nodes:s(r.nodes,c)));break;case"parent":for(n=0,l=this.length;l>n;n++)r=this[n].parent,!r||r.type===p.FRAGMENT||c&&i(r,c)||u.push(r);v(u);break;case"closest":case"find":if(null==c)break;for(n=0,l=this.length;l>n;n++)a(this[n][c.nextKey],c,u);break;case"first":case"last":var f;for(n=0,l=this.length;l>n;n++)if(f="first"===e?n:l-n-1,r=this[f],null==c||i(r,c)){u[0]=r;break}}return this.pushStack(u)}}),d}(Mask);return Mask});