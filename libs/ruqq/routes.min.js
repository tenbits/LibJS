(function(e){function n(e){var n={};if(!e)return n;for(var t,r=0,o=e.split("&");o.length>r;r++)t=o[r].split("="),n[t[0]]=t[1];return n}function t(e,n){if(null==e)return null;for(var t,r,o=0,l=e.length;l>o;o++)if(t=e[o],t.match.test(n)){if(null==r){r=[t];continue}r.push(t)}return r}function r(e){this.root=e,this.rootRegexp=f(e),this.routes=[]}function o(e,n){if(null==n)return e;null==e&&(e={});for(var t in n)e[t]=n[t];return e}var l,i=[],s=function(){function e(e){return e.replace(/([\\\[\]\(\)])/g,"\\$1")}var n={":":"(/([\\w\\.\\-_]+))","?":"(/([\\w\\.\\-_]+))?","var":"([\\w\\.\\-_]+)"};return function(t){var r,o,l,i,s=t.match.split("/"),u="",a=2;console.log(t);for(var c,f=0,p=s.length;p>f;f++)c=s[f],c?(l=c[0],i="?"===c[0],i&&(c=c.substring(1)),o=c.indexOf(":"),-1!==o&&(r=c.substring(0,o),u+=(u?"&":"")+c.substring(o+1)+"=$"+a,c=r+n["var"]),i||-1!==o?(s[f]="(/"+c+")"+(i?"?":""),a+=2):s[f]="/"+e(c)):(s.splice(f,1),f--,p--);return t.match=RegExp("^"+s.join("")),t.param=u,console.log("match",s.join(""),u),window.r=t.match,t}}(),u=function(e,t){if(e)for(var r,o=0,l=e.length;l>o;o++){r=e[o];var i=r.match.exec(t);i&&i.length&&r.callback(n(t.replace(r.match,r.param)),t)}},a=function(e,n){return e?n?("/"==n[0]&&(n=n.substring(1)),"/"==e[e.length-1]?e+n:e+"/"+n):e:n},c=function(){return(e.location.hash||"").replace(/^#\/?/,"/")},f=function(e){return e instanceof RegExp?e:("string"!=typeof e&&(console.error("Unsupported type",e),e=""),e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),RegExp("^"+e,"i"))};r.prototype={constructor:r,hashchanged:function(e){if(null==e&&(e=c(),"/"!==this.root)){if(this.rootRegexp.test(e)===!1)return;e=e.replace(this.rootRegexp,"")}i.push(e),u(this.routes,e)},add:function(e){if(null!=e){if("string"==typeof e)return this.add({match:e,callback:arguments[1]}),void 0;for(var n=e instanceof Array,t=n?e.length:1,r=null,o=0;t>o;o++)r=n?e[o]:e,"string"==typeof r.match&&s(r),this.routes.push(r)}},clear:function(){this.routes=[]},navigate:function(n){e.location.hash=n?a(this.root,n):""},current:function(){var e=c(),r=t(this.routes,e),l={};if(null==r)return null;for(var i,s=0,u=r.length;u>s;s++)i=r[s],l=o(l,n(e.replace(i.match,i.param)));return l},createHandler:function(e){e=e.replace(/(^[\/]+)|([\/]+$)/g,"");var n=a(this.root,e),t=new r(n);return this.add(e,function(e,r){t.hashchanged(r.replace(n,""))}),t},back:function(){if(!(2>i.length)){var e=(i.pop(),i.pop());this.navigate(e)}},stack:function(){return i}},e.routes=l=new r("/"),e.onhashchange=function(){l.hashchanged(c())}})(window);