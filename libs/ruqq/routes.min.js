(function(e){function t(e){var t={};if(!e)return t;for(var n,r=0,o=e.split("&");o.length>r;r++)n=o[r].split("="),t[n[0]]=n[1];return t}function n(e,t){if(null==e)return null;for(var n,r,o=0,l=e.length;l>o;o++)if(n=e[o],n.match.test(t)){if(null==r){r=[n];continue}r.push(n)}return r}function r(e){this.root=e,this.rootRegexp=f(e),this.routes=[]}function o(e,t){if(null==t)return e;null==e&&(e={});for(var n in t)e[n]=t[n];return e}var l,i=[],s=function(){function e(e){return e.replace(/([\\\[\]\(\)])/g,"\\$1")}var t={":":"(/([\\w\\.\\-_]+))","?":"(/([\\w\\.\\-_]+))?","var":"([\\w\\.\\-_]+)"};return function(n){var r,o,l,i,s=n.match.split("/"),a="",u=2;console.log(n);for(var c,f=0,p=s.length;p>f;f++)c=s[f],c?(l=c[0],i="?"===c[0],i&&(c=c.substring(1)),o=c.indexOf(":"),-1!==o&&(r=c.substring(0,o),a+=(a?"&":"")+c.substring(o+1)+"=$"+u,c=r+t["var"]),i||-1!==o?(s[f]="(/"+c+")"+(i?"?":""),u+=2):s[f]="/"+e(c)):(s.splice(f,1),f--,p--);return n.match=RegExp("^"+s.join("")),n.param=a,console.log("match",s.join(""),a),window.r=n.match,n}}(),a=function(e,n){if(e)for(var r,o=0,l=e.length;l>o;o++){r=e[o];var i=r.match.exec(n);i&&i.length&&r.callback(t(n.replace(r.match,r.param)),n)}},u=function(e,t){return e?t?("/"==t[0]&&(t=t.substring(1)),"/"==e[e.length-1]?e+t:e+"/"+t):e:t},c=function(){return(e.location.hash||"").replace(/^#\/?/,"/")},f=function(e){return e instanceof RegExp?e:("string"!=typeof e&&(console.error("Unsupported type",e),e=""),e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),RegExp("^"+e,"i"))};r.prototype={constructor:r,hashchanged:function(e){if(null==e&&(e=c(),"/"!==this.root)){if(this.rootRegexp.test(e)===!1)return;e=e.replace(this.rootRegexp,"")}i.push(e),a(this.routes,e)},add:function(e){if(null!=e){if("string"==typeof e)return this.add({match:e,callback:arguments[1]}),void 0;for(var t=e instanceof Array,n=t?e.length:1,r=null,o=0;n>o;o++)r=t?e[o]:e,"string"==typeof r.match&&s(r),this.routes.push(r)}},clear:function(){this.routes=[]},navigate:function(t){e.location.hash=t?u(this.root,t):""},current:function(){var e=c(),r=n(this.routes,e),l={};if(null==r)return null;for(var i,s=0,a=r.length;a>s;s++)i=r[s],l=o(l,t(e.replace(i.match,i.param)));return l},createHandler:function(e){e=e.replace(/(^[\/]+)|([\/]+$)/g,"");var t=u(this.root,e),n=new r(t);return this.add(e,function(e,r){n.hashchanged(r.replace(t,""))}),n},back:function(){if(!(2>i.length)){var e=(i.pop(),i.pop());this.navigate(e)}},stack:function(){return i}},e.routes=l=new r("/"),e.onhashchange=function(){l.hashchanged(c())}})(window);